name: GitHub Actions Docker Build
on: push

jobs:
  HostedActions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a $ event."
      - run: echo "üêß This job is now running on a $ server hosted by GitHub!"
      - run: echo "üîé The name of your branch is $ and your repository is $."
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: echo "üí° The $ repository has been cloned to the runner."
      - run: echo ${{ github.ref }}
      - name: Run Tests
        run: |
          set -x
          pip3 install -r requirements.txt
          python3 -m pytest
          
          # pytest --junitxml=test-results/coverage.xml
          # python3 -m pytest --cov-report xml:test-results/results.xml
          # python3 -m pytest -v -o junit_family=xunit1 --cov-report xml:test-results/coverage.xml --junitxml=test-results/results.xml
          python3 -m pytest -v --cov --cov-report xml:test-results/coverage.xml --junitxml=test-results/results.xml

          pwd
          ls -ltra
          ls -ltra ./test-results || true 
          cat ./test-results/results.xml

          ls -ltra /home/runner/work/cloudFunctionPython/cloudFunctionPython/test-results
          
          echo ${{ github.ref }}
          #pytest -v  --cov --cov-report=xml --cov-report=html
        if: contains('
            refs/heads/main
           ', github.ref)
      - uses: sonarsource/sonarqube-scan-action@master
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
        if: contains('
            refs/heads/main
           ', github.ref)
